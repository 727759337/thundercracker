/* -*- mode: C; c-basic-offset: 4; intent-tabs-mode: nil -*-
 *
 * Copyright <c> 2012 Sifteo, Inc. All rights reserved.
 */
 
////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

#include "Puzzle.h"
	
////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

using namespace Sifteo;

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

namespace Buddies {

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

Puzzle::Puzzle()
    : mChapterTitle(NULL)
    , mCutsceneTextStart()
    , mNumCutsceneTextStart(0)
    , mCutsceneTextEnd()
    , mNumCutsceneTextEnd(0)
    , mClue(NULL)
    , mBuddies()
    , mNumBuddies(0)
    , mNumShuffles(0)
    , mStartState()
    , mEndState()
{
    for (unsigned int i = 0; i < arraysize(mCutsceneTextStart); ++i)
    {
        mCutsceneTextStart[i] = NULL;
    }
    
    for (unsigned int i = 0; i < arraysize(mCutsceneTextEnd); ++i)
    {
        mCutsceneTextEnd[i] = NULL;
    }
    
    for (unsigned int i = 0; i < arraysize(mBuddies); ++i)
    {
        mBuddies[i] = 0;
    }
}   

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

Puzzle::Puzzle(
    const char *chapterTitle,
    const char cutsceneTextStart[][32], unsigned int numCutsceneTextStart,
    const char cutsceneTextEnd[][32], unsigned int numCutsceneTextEnd,
    const char *clue,
    const unsigned int buddies[], unsigned int numBuddies,
    unsigned int numShuffles,
    const Piece startState[kMaxBuddies][NUM_SIDES],
    const Piece endState[kMaxBuddies][NUM_SIDES])
    : mChapterTitle(chapterTitle)
    , mCutsceneTextStart()
    , mNumCutsceneTextStart(numCutsceneTextStart)
    , mCutsceneTextEnd()
    , mNumCutsceneTextEnd(numCutsceneTextEnd)
    , mClue(clue)
    , mBuddies()
    , mNumBuddies(numBuddies)
    , mNumShuffles(numShuffles)
    , mStartState()
    , mEndState()
{
    ASSERT(mNumCutsceneTextStart < arraysize(mCutsceneTextStart));
    for (unsigned int i = 0; i < mNumCutsceneTextStart; ++i)
    {
        mCutsceneTextStart[i] = cutsceneTextStart[i];
    }
    
    ASSERT(mNumCutsceneTextEnd < arraysize(mCutsceneTextEnd));
    for (unsigned int i = 0; i < mNumCutsceneTextEnd; ++i)
    {
        mCutsceneTextEnd[i] = cutsceneTextEnd[i];
    }
    
    ASSERT(mNumBuddies < arraysize(mBuddies));
    for (unsigned int i = 0; i < mNumBuddies; ++i)
    {
        mBuddies[i] = buddies[i];
    }
    
    for (unsigned int i = 0; i < kMaxBuddies; ++i)
    {
        for (unsigned int j = 0; j < NUM_SIDES; ++j)
        {
            mStartState[i][j] = startState[i][j];
            mEndState[i][j] = endState[i][j];
        }
    }
}   

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const char *Puzzle::GetChapterTitle() const
{
    return mChapterTitle;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetChapterTitle(const char *chapterTitle)
{
    mChapterTitle = chapterTitle;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::ClearCutsceneTextStart()
{
    mNumCutsceneTextStart = 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::AddCutsceneTextStart(const char *cutsceneTextStart)
{
    ASSERT(mNumCutsceneTextStart < arraysize(mCutsceneTextStart));
    mCutsceneTextStart[mNumCutsceneTextStart++] = cutsceneTextStart;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const char *Puzzle::GetCutsceneTextStart(unsigned int cutsceneIndex) const
{
    ASSERT(cutsceneIndex < arraysize(mCutsceneTextStart));
    return mCutsceneTextStart[cutsceneIndex];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumCutsceneTextStart() const
{
    return mNumCutsceneTextStart;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::ClearCutsceneTextEnd()
{
    mNumCutsceneTextEnd = 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::AddCutsceneTextEnd(const char *cutsceneTextEnd)
{
    ASSERT(mNumCutsceneTextEnd < arraysize(mCutsceneTextEnd));
    mCutsceneTextEnd[mNumCutsceneTextEnd++] = cutsceneTextEnd;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const char *Puzzle::GetCutsceneTextEnd(unsigned int cutsceneIndex) const
{
    ASSERT(cutsceneIndex < arraysize(mCutsceneTextEnd));
    return mCutsceneTextEnd[cutsceneIndex];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumCutsceneTextEnd() const
{
    return mNumCutsceneTextEnd;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const char *Puzzle::GetClue() const
{
    return mClue;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetClue(const char *clue)
{
    mClue = clue;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::ClearBuddies()
{
    mNumBuddies = 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::AddBuddy(unsigned int buddyId)
{
    ASSERT(mNumBuddies < arraysize(mBuddies));
    mBuddies[mNumBuddies++] = buddyId;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetBuddy(unsigned int buddyIndex) const
{
    ASSERT(buddyIndex < arraysize(mBuddies));
    return mBuddies[buddyIndex];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumBuddies() const
{
    return mNumBuddies;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumShuffles() const
{
    return mNumShuffles;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetNumShuffles(unsigned int numShuffles)
{
    mNumShuffles = numShuffles;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const Piece &Puzzle::GetStartState(unsigned int buddy, Cube::Side side) const
{
    ASSERT(buddy < arraysize(mStartState));
    ASSERT(side < int(arraysize(mStartState[buddy])));
    return mStartState[buddy][side];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetStartState(unsigned int buddy, Cube::Side side, const Piece &piece)
{
    ASSERT(buddy < arraysize(mStartState));
    ASSERT(side < int(arraysize(mStartState[buddy])));
    mStartState[buddy][side] = piece;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const Piece &Puzzle::GetEndState(unsigned int buddy, Cube::Side side) const
{
    ASSERT(buddy < arraysize(mEndState));
    ASSERT(side < int(arraysize(mEndState[buddy])));
    return mEndState[buddy][side];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetEndState(unsigned int buddy, Cube::Side side, const Piece &piece)
{
    ASSERT(buddy < arraysize(mEndState));
    ASSERT(side < int(arraysize(mEndState[buddy])));
    mEndState[buddy][side] = piece;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
