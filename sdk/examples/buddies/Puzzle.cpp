/* -*- mode: C; c-basic-offset: 4; intent-tabs-mode: nil -*-
 *
 * Copyright <c> 2012 Sifteo, Inc. All rights reserved.
 */
 
////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

#include "Puzzle.h"
	
////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

using namespace Sifteo;

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

namespace Buddies {

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

Puzzle::Puzzle()
    : mBook(0)
    , mTitle(NULL)
    , mClue(NULL)
    , mCutsceneLineStart()
    , mCutsceneLineEnd()
    , mBuddies()
    , mNumCutsceneLineStart(0)
    , mNumCutsceneLineEnd(0)
    , mCutsceneEnvironemnt(0)
    , mNumShuffles(0)
    , mNumBuddies(0)
    , mPiecesStart()
    , mPiecesEnd()
{
    Reset();
}   

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

Puzzle::Puzzle(
    unsigned int book,
    const char *title,
    const char *clue,
    const CutsceneLine cutsceneLineStart[], unsigned int numCutsceneLineStart,
    const CutsceneLine cutsceneLineEnd[], unsigned int numCutsceneLineEnd,
    unsigned int cutsceneEnvironment,
    const BuddyId buddies[], unsigned int numBuddies,
    unsigned int numShuffles,
    const Piece piecesStart[][NUM_SIDES],
    const Piece piecesEnd[][NUM_SIDES])
    : mBook(book)
    , mTitle(title)
    , mClue(clue)
    , mCutsceneLineStart()
    , mCutsceneLineEnd()
    , mBuddies()
    , mNumCutsceneLineStart(numCutsceneLineStart)
    , mNumCutsceneLineEnd(numCutsceneLineEnd)
    , mCutsceneEnvironemnt(cutsceneEnvironment)
    , mNumShuffles(numShuffles)
    , mNumBuddies(numBuddies)
    , mPiecesStart()
    , mPiecesEnd()
{
    ASSERT(mNumCutsceneLineStart < arraysize(mCutsceneLineStart));
    for (unsigned int i = 0; i < mNumCutsceneLineStart; ++i)
    {
        mCutsceneLineStart[i] = cutsceneLineStart[i];
    }
    
    ASSERT(mNumCutsceneLineStart < arraysize(mCutsceneLineStart));
    for (unsigned int i = 0; i < mNumCutsceneLineStart; ++i)
    {
        mCutsceneLineStart[i] = cutsceneLineStart[i];
    }
    
    ASSERT(mNumCutsceneLineEnd < arraysize(mCutsceneLineEnd));
    for (unsigned int i = 0; i < mNumCutsceneLineEnd; ++i)
    {
        mCutsceneLineEnd[i] = cutsceneLineEnd[i];
    }
    
    ASSERT(mNumBuddies < arraysize(mBuddies));
    for (unsigned int i = 0; i < mNumBuddies; ++i)
    {
        mBuddies[i] = buddies[i];
    }
    
    for (unsigned int i = 0; i < mNumBuddies; ++i)
    {
        for (unsigned int j = 0; j < NUM_SIDES; ++j)
        {
            mPiecesStart[i][j] = piecesStart[i][j];
            mPiecesEnd[i][j] = piecesEnd[i][j];
        }
    }
}   

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::Reset()
{
    mBook = 0;
    mTitle = NULL;
    
    for (unsigned int i = 0; i < arraysize(mCutsceneLineStart); ++i)
    {
        mCutsceneLineStart[i] = CutsceneLine();
    }
    mNumCutsceneLineStart = 0;
    
    for (unsigned int i = 0; i < arraysize(mCutsceneLineEnd); ++i)
    {
        mCutsceneLineEnd[i] = CutsceneLine();
    }
    mNumCutsceneLineEnd = 0;
    
    mCutsceneEnvironemnt = 0;
    
    mClue = NULL;
    mNumShuffles = 0;
    
    for (unsigned int i = 0; i < arraysize(mBuddies); ++i)
    {
        mBuddies[i] = 0;
    }
    mNumBuddies = 0;
    
    for (unsigned int i = 0; i < kMaxBuddies; ++i)
    {
        for (unsigned int j = 0; j < NUM_SIDES; ++j)
        {
            mPiecesStart[i][j] = Piece();
            mPiecesEnd[i][j] = Piece();
        }
    }
}   

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetBook() const
{
    return mBook;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetBook(unsigned int book)
{
    mBook = book;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const char *Puzzle::GetTitle() const
{
    return mTitle;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetTitle(const char *title)
{
    mTitle = title;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const char *Puzzle::GetClue() const
{
    return mClue;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetClue(const char *clue)
{
    mClue = clue;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::AddCutsceneLineStart(const CutsceneLine &line)
{
    ASSERT(mNumCutsceneLineStart < arraysize(mCutsceneLineStart));
    ASSERT(line.mText != NULL);
    mCutsceneLineStart[mNumCutsceneLineStart++] = line;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const CutsceneLine &Puzzle::GetCutsceneLineStart(unsigned int cutsceneIndex) const
{
    ASSERT(cutsceneIndex < arraysize(mCutsceneLineStart));
    return mCutsceneLineStart[cutsceneIndex];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumCutsceneLineStart() const
{
    return mNumCutsceneLineStart;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::AddCutsceneLineEnd(const CutsceneLine &line)
{
    ASSERT(mNumCutsceneLineEnd < arraysize(mCutsceneLineEnd));
    ASSERT(line.mText != NULL);
    mCutsceneLineEnd[mNumCutsceneLineEnd++] = line;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const CutsceneLine &Puzzle::GetCutsceneLineEnd(unsigned int cutsceneIndex) const
{
    ASSERT(cutsceneIndex < arraysize(mCutsceneLineEnd));
    return mCutsceneLineEnd[cutsceneIndex];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumCutsceneLineEnd() const
{
    return mNumCutsceneLineEnd;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetCutsceneEnvironment() const
{
    return mCutsceneEnvironemnt;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetCutsceneEnvironment(unsigned int cutsceneEnvionment)
{
    mCutsceneEnvironemnt = cutsceneEnvionment;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumShuffles() const
{
    return mNumShuffles;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetNumShuffles(unsigned int numShuffles)
{
    mNumShuffles = numShuffles;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::AddBuddy(BuddyId buddyId)
{
    ASSERT(mNumBuddies < arraysize(mBuddies));
    mBuddies[mNumBuddies++] = buddyId;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

BuddyId Puzzle::GetBuddy(unsigned int buddyIndex) const
{
    ASSERT(buddyIndex < arraysize(mBuddies));
    return BuddyId(mBuddies[buddyIndex]);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

unsigned int Puzzle::GetNumBuddies() const
{
    return mNumBuddies;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const Piece &Puzzle::GetPieceStart(unsigned int buddy, Cube::Side side) const
{
    ASSERT(buddy < arraysize(mPiecesStart));
    ASSERT(side < int(arraysize(mPiecesStart[buddy])));
    return mPiecesStart[buddy][side];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetPieceStart(unsigned int buddy, Cube::Side side, const Piece &piece)
{
    ASSERT(buddy < arraysize(mPiecesStart));
    ASSERT(side < int(arraysize(mPiecesStart[buddy])));
    mPiecesStart[buddy][side] = piece;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

const Piece &Puzzle::GetPieceEnd(unsigned int buddy, Cube::Side side) const
{
    ASSERT(buddy < arraysize(mPiecesEnd));
    ASSERT(side < int(arraysize(mPiecesEnd[buddy])));
    return mPiecesEnd[buddy][side];
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

void Puzzle::SetPieceEnd(unsigned int buddy, Cube::Side side, const Piece &piece)
{
    ASSERT(buddy < arraysize(mPiecesEnd));
    ASSERT(side < int(arraysize(mPiecesEnd[buddy])));
    mPiecesEnd[buddy][side] = piece;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

}

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
