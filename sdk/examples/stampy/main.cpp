/* -*- mode: C; c-basic-offset: 4; intent-tabs-mode: nil -*-
 *
 * Sifteo SDK Example.
 * Copyright <c> 2012 Sifteo, Inc. All rights reserved.
 */

/*
 * XXX: work in progress
 */

#include <sifteo.h>
using namespace Sifteo;

static Metadata M = Metadata()
    .title("Stampy SDK Example")
    .cubeRange(1);

const CubeID cube(0);
static VideoBuffer vid;

struct MonsterData {
    uint8_t fb[512 + 32];
};

// #13 -- Mr_Pink
static const struct MonsterData Mr_Pink = {{
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x80, 0x08, 0x00, 0x00, 0x80, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x28, 0x08, 0x00, 0x00, 0x80, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x80, 0x22, 0x08, 0x00, 0x00, 0x40, 0x44, 0x44, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x80, 0x22, 0x08, 0x00, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x80, 0x22, 0x08, 0x00, 0x00, 0x28, 0x22, 0x22, 0x86, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x28, 0x22, 0x08, 0x00, 0x80, 0x22, 0x22, 0x22, 0x62, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x28, 0x22, 0x88, 0x00, 0x88, 0x82, 0x22, 0x82, 0x62, 0x86, 0x08, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x28, 0x22, 0x82, 0x08, 0x28, 0x22, 0x22, 0x22, 0x22, 0x66, 0x88, 0x00, 0x00, 0x00, 0x00,
     0x00, 0x28, 0x22, 0x22, 0x88, 0x28, 0x82, 0x88, 0x88, 0x22, 0x62, 0x86, 0x08, 0x00, 0x00, 0x00,
     0x00, 0x28, 0x22, 0x22, 0x22, 0x22, 0x82, 0x88, 0x88, 0x22, 0x22, 0x66, 0x88, 0x00, 0x00, 0x00,
     0x00, 0x28, 0x22, 0x22, 0x22, 0x22, 0x22, 0x88, 0x28, 0x22, 0x22, 0x62, 0x86, 0x08, 0x00, 0x00,
     0x00, 0x80, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x66, 0x88, 0x00, 0x00,
     0x00, 0x80, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x28, 0x22, 0x62, 0x86, 0x00, 0x00,
     0x00, 0x80, 0x66, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x88, 0x22, 0x62, 0x86, 0x00, 0x00,
     0x00, 0x00, 0x68, 0x66, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x82, 0x22, 0x62, 0x86, 0x00, 0x00,
     0x00, 0x00, 0x80, 0x68, 0x26, 0x22, 0x22, 0x22, 0x22, 0x22, 0x88, 0x22, 0x66, 0x88, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x80, 0x28, 0x22, 0x22, 0x22, 0x22, 0x22, 0x28, 0x62, 0x86, 0x08, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x28, 0x22, 0x22, 0x22, 0x22, 0x22, 0x28, 0x62, 0x88, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x28, 0x22, 0x22, 0x22, 0x22, 0x22, 0x88, 0x88, 0x08, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x28, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x66, 0x08, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x80, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x66, 0x08, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x80, 0x22, 0x62, 0x86, 0x88, 0x88, 0x22, 0x22, 0x66, 0x08, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x00, 0x80, 0x22, 0x62, 0x08, 0x00, 0x80, 0x88, 0x22, 0x66, 0x88, 0x00, 0x00, 0x00,
     0x00, 0x00, 0x80, 0x28, 0x22, 0x66, 0x08, 0x00, 0x00, 0x80, 0x22, 0x62, 0x86, 0x08, 0x00, 0x00,
     0x00, 0x00, 0x88, 0x22, 0x62, 0x86, 0x00, 0x00, 0x00, 0x80, 0x28, 0x22, 0x66, 0x88, 0x00, 0x00,
     0x00, 0x00, 0x28, 0x22, 0x66, 0x86, 0x00, 0x00, 0x00, 0x00, 0x28, 0x22, 0x62, 0x86, 0x00, 0x00,
     0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x08, 0x00,
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0xff,0xff, 0x00,0x00, 0xfb,0xf5, 0x00,0x00, 0xff,0x3d, 0x00,0x00, 0xd3,0xfa, 0x00,0x00,
     0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00, 0x00,0x00,
}};

void draw_stipple()
{
    vid.poke(0, 0x0110);

    vid.pokeb(0x320, 1);
    vid.pokeb(0x321, 2);
    vid.pokeb(0x322, 0);
    vid.pokeb(0x323, 128);
    vid.pokeb(0x324, 0);
    vid.setWindow(0, 128);

    System::paint();
    System::finish();
}

void draw_mrpink()
{
    static Random r;
    Int2 pos = {
        r.randrange<unsigned>(0, LCD_width - 32),
        r.randrange<unsigned>(0, LCD_height - 32),
    };

    vid.fb32.set((uint16_t*) &Mr_Pink.fb[0]);

    vid.pokeb(0x320, 16);
    vid.pokeb(0x321, 32);
    vid.pokeb(0x322, pos.x);
    vid.pokeb(0x323, 32);
    vid.pokeb(0x324, 0);
    vid.setWindow(pos.y, 32);

    System::paint();
    System::finish();
}

void main()
{
    vid.initMode((VideoMode) 0x28);
    vid.colormap.set((RGB565*) &Mr_Pink.fb[512]);
    vid.attach(cube);

    draw_stipple();

    while (1) {
        draw_mrpink();
        //draw_stipple();
    }
}
