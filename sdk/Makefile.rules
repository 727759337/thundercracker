# we expect $(TC_DIR)/sdk/Makefile.defs has already been included


######## Normal target rules

all: $(BIN)

%.o: %.cpp $(CDEPS)
	$(CC) -c -o $@ $< $(CCFLAGS)

$(BIN): $(OBJS) $(LD)
	$(LD) -o $@ $(OBJS) $(LDFLAGS)

$(ASSETS).gen.cpp: $(STIR) $(ASSETDEPS)
	$(STIR) $(ASSETS).lua -o $(ASSETS).gen.cpp -o $(ASSETS).gen.h -o $(ASSETS).html -v

clean:
	rm -f $(BIN) *.o *.d $(GENERATED_FILES)

.PHONY: clean all

-include $(OBJS:%.o=%.d)

######## Development utility rules

llvm-dis: $(BIN)
	@$(LLVM_BIN)/llvm-dis $(BIN) -o - | less

objdump: $(BIN)
	arm-none-eabi-objdump -d $(BIN) | arm-none-eabi-c++filt | less

asm: program.s
	less $^

program.s: $(OBJS) $(LD)
	$(LD) -asm -o $@ $(OBJS) $(LDFLAGS)

readelf: $(BIN)
	arm-none-eabi-readelf -a $(BIN) | arm-none-eabi-c++filt | less

.PHONY: llvm-dis objdump asm readelf
