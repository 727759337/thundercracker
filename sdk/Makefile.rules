# we expect $(TC_DIR)/sdk/Makefile.defs has already been included

all: $(BIN)

disassemble: $(BIN)
	@$(LLVM_BIN)/llvm-dis $(BIN) -o -

symlist: $(BIN)
	@$(LLVM_BIN)/llvm-nm $(BIN) | grep "U "

%.o: %.cpp $(CDEPS)
	$(CC) -c -o $@ $< $(CCFLAGS)

$(BIN): $(OBJS)
	$(LD) -o $@ $^ $(LDFLAGS)

$(ASSETS).gen.cpp: $(STIR) $(ASSETDEPS)
	$(STIR) $(ASSETS).lua -o $(ASSETS).gen.cpp -o $(ASSETS).gen.h -o $(ASSETS).html -v

.PHONY: clean all disassemble

clean:
	rm -f $(BIN) *.o *.d $(GENERATED_FILES)

-include $(OBJS:%.o=%.d)
